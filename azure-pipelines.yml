jobs:
- job: 'Linux Unit Tests'
  pool:
    vmImage: 'ubuntu-16.04'
  steps:
  - script: ./build.sh test-one skipdocs
    displayName: build and unit test
  - task: PublishTestResults@2
    inputs:
        testRunner: VSTest
        testResultsFiles: '**/*.trx'
        testRunTitle: Linux Unit Tests

- job: 'Windows Nuget Package Tests'
  pool:
    vmImage: 'vs2017-win2016'
  steps:
  - script: build.bat canary skipdocs
    displayName: build and unit test
  - task: PublishTestResults@2
    inputs:
      testRunner: VSTest
      testResultsFiles: '**/*.trx'
      testRunTitle: Windows Unit Tests

- job: 'Windows Integration Tests'
  dependsOn: 'Windows Nuget Package Tests'
  pool:
      vmImage: 'vs2017-win2016'
  strategy:
    maxParallel: 3 
    matrix:
      es653:
        esVersion: '6.5.3'
      es632:
          esVersion: '6.3.2'
  steps:
      - script: 'build.bat integrate $(esVersion) skipdocs'
        displayName: '$(esVersion) integration tests'
